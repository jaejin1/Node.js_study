/**
 * Created by ASUS on 2017/5/17.
 */
var mysql = require('mysql');
var pool = mysql.createPool({
    host: 'localhost',
    user: 'root',
    password: 'zxd6654',
    database: 'zxd'
});
exports.query = function () {
    var args = arguments;
    var sqlStr = args[0];
    var params = [];
    var callback;
    /*
     * 传递两个参数  第一个 是SQL语句  第二个  回调函数
     * 传递三个参数  第一个 是SQL语句  第二个  是你执行的数据  第三个  回调函数
     * */

    if (args.length === 2 && typeof args[1] === 'function') {
        callback = args[1];

    } else if (args.length === 3 && Array.isArray(args[1]) && typeof args[2] === 'function') {
        params = args[1];
        callback = args[2];
    } else {
        throw new Error('参数不匹配');
    }
    pool.getConnection(function (err, connection) {
        if (err) {
            callback(err);
        }
        connection.query(sqlStr, params, function (err, rows) {
            if (err) {
                callback(err);
            }
           callback.apply(null,arguments);
        //    apply可以劫持对象，复制到当前的属性里面
        //    这里就是将arguments 传给callback里面
        });
        connection.release();
    })
};